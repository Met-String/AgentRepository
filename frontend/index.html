<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentSquare Chat</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            background-color: #f0f0f0;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-panel {
            background-color: #ffffff;
            border-right: 1px solid #ddd;
        }

        .chat-log {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message {
            font-size: 14px;
            word-break: break-word;
        }

        .message.system {
            color: #666;
            font-style: italic;
        }

        .input-row {
            display: flex;
            border-top: 1px solid #ddd;
            padding: 12px;
            gap: 8px;
        }

        .input-row input[type="text"] {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #bbb;
        }

        .input-row button {
            padding: 8px 16px;
            border: none;
            background-color: #1976d2;
            color: #fff;
            cursor: pointer;
        }

        .input-row button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }

        .placeholder-panel {
            justify-content: center;
            align-items: center;
            color: #999;
        }
    </style>
</head>
<body>
    <section class="panel chat-panel">
        <div id="chatLog" class="chat-log"></div>
        <form id="chatForm" class="input-row" autocomplete="off">
            <input id="chatInput" type="text" placeholder="输入消息" required />
            <button id="sendButton" type="submit">发送</button>
        </form>
    </section>
    <section class="panel placeholder-panel">
        <span>右侧留空，可按需扩展。</span>
    </section>

    <script>
        const chatLog = document.getElementById('chatLog');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');

        function appendMessage(text, type = 'user') {
            const entry = document.createElement('div');
            entry.className = `message ${type}`;
            entry.textContent = text;
            chatLog.appendChild(entry);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        const socket = new WebSocket('ws://localhost:8080/ws');

        socket.addEventListener('open', () => {
            appendMessage('已连接到服务器。', 'system');
            sendButton.disabled = false;
        });

        socket.addEventListener('message', (event) => {
            appendMessage(event.data, 'server');
        });

        socket.addEventListener('close', () => {
            appendMessage('连接已关闭。', 'system');
            sendButton.disabled = true;
        });

        socket.addEventListener('error', () => {
            appendMessage('连接出现错误。', 'system');
        });

        chatForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const text = chatInput.value.trim();
            if (!text) {
                return;
            }
            if (socket.readyState === WebSocket.OPEN) {
                socket.send(text);
                appendMessage(text, 'user');
                chatInput.value = '';
                chatInput.focus();
            } else {
                appendMessage('当前未连接到服务器。', 'system');
            }
        });

        sendButton.disabled = socket.readyState !== WebSocket.OPEN;
    </script>
</body>
</html>
